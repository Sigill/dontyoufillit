Date.now||(Date.now=function(){return(new Date).getTime()});
(function(){for(var a=["webkit","moz"],b=0;b<a.length&&!window.requestAnimationFrame;++b){var c=a[b];window.requestAnimationFrame=window[c+"RequestAnimationFrame"];window.cancelAnimationFrame=window[c+"CancelAnimationFrame"]||window[c+"CancelRequestAnimationFrame"]}if(/iP(ad|hone|od).*OS 6/.test(window.navigator.userAgent)||!window.requestAnimationFrame||!window.cancelAnimationFrame){var g=0;window.requestAnimationFrame=function(a){var b=Date.now(),c=Math.max(g+16,b);return setTimeout(function(){a(g=
c)},c-b)};window.cancelAnimationFrame=clearTimeout}})();var Stats=function(){var a=Date.now(),b=a,c=0,g=Infinity,h=0,k=0,m=Infinity,y=0,l=0,z=0,u=document.createElement("div");u.id="stats";u.addEventListener("mousedown",function(a){a.preventDefault();B(++z%2)},!1);u.style.cssText="width:80px;opacity:0.9;cursor:pointer";var q=document.createElement("div");q.id="fps";q.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#002";u.appendChild(q);var w=document.createElement("div");w.id="fpsText";w.style.cssText="color:#0ff;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px";
w.innerHTML="FPS";q.appendChild(w);var s=document.createElement("div");s.id="fpsGraph";s.style.cssText="position:relative;width:74px;height:30px;background-color:#0ff";for(q.appendChild(s);74>s.children.length;){var d=document.createElement("span");d.style.cssText="width:1px;height:30px;float:left;background-color:#113";s.appendChild(d)}var f=document.createElement("div");f.id="ms";f.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#020;display:none";u.appendChild(f);var r=document.createElement("div");
r.id="msText";r.style.cssText="color:#0f0;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px";r.innerHTML="MS";f.appendChild(r);var n=document.createElement("div");n.id="msGraph";n.style.cssText="position:relative;width:74px;height:30px;background-color:#0f0";for(f.appendChild(n);74>n.children.length;)d=document.createElement("span"),d.style.cssText="width:1px;height:30px;float:left;background-color:#131",n.appendChild(d);var B=function(a){z=a;switch(z){case 0:q.style.display=
"block";f.style.display="none";break;case 1:q.style.display="none",f.style.display="block"}};return{REVISION:12,domElement:u,setMode:B,begin:function(){a=Date.now()},end:function(){var d=Date.now();c=d-a;g=Math.min(g,c);h=Math.max(h,c);r.textContent=c+" MS ("+g+"-"+h+")";var f=Math.min(30,30-30*(c/200));n.appendChild(n.firstChild).style.height=f+"px";l++;d>b+1E3&&(k=Math.round(1E3*l/(d-b)),m=Math.min(m,k),y=Math.max(y,k),w.textContent=k+" FPS ("+m+"-"+y+")",f=Math.min(30,30-30*(k/100)),s.appendChild(s.firstChild).style.height=
f+"px",b=d,l=0);return d},update:function(){a=this.end()}}};"object"===typeof module&&(module.exports=Stats);function Observable(){this.observers=[]}Observable.prototype.addObserver=function(a){this.observers.push(a)};Observable.prototype.removeObserver=function(a){a=this.observers.indexOf(a);~a&&this.observers.splice(a,1)};Observable.prototype.notifyObservers=function(a){for(var b=this.observers.length-1;0<=b;b--)this.observers[b](a)};Math.sign||(Math.__proto__.sign=function(a){return isNaN(a)?NaN:0===a?a:0<a?1:-1});function vectorLength(a,b){return Math.sqrt(a*a+b*b)}function RK41DObject_State(a,b){this.u=a;this.s=b}function RK41DObject_Derivative(a,b){this.du=a;this.ds=b}function RK41DObject(){this.state=new RK41DObject_State(0,0)}
RK41DObject.prototype.evaluate=function(a,b,c,g){if("undefined"==typeof c)return new RK41DObject_Derivative(a.s,this.acceleration(a,b));a=new RK41DObject_State(a.u+g.du*c,a.s+g.ds*c);return new RK41DObject_Derivative(a.s,this.acceleration(a,b+c))};
RK41DObject.prototype.integrate=function(a,b){var c=this.evaluate(this.state,a),g=this.evaluate(this.state,a,0.5*b,c),h=this.evaluate(this.state,a,0.5*b,g),k=this.evaluate(this.state,a,b,h),m=1/6*(c.ds+2*(g.ds+h.ds)+k.ds);this.state.u+=1/6*(c.du+2*(g.du+h.du)+k.du)*b;this.state.s+=m*b};function normalizeRadian(a){for(;a>2*Math.PI;)a-=2*Math.PI;for(;0>a;)a+=2*Math.PI;return a}function Cannon(){RK41DObject.call(this);this.state.u=0;this.state.s=Math.PI/3}Cannon.prototype=new RK41DObject;
Cannon.prototype.constructor=RK41DObject;Cannon.prototype.acceleration=function(a,b){return 0};Cannon.prototype.getAngle=function(){return this.state.u+Math.PI/2};Cannon.prototype.update=function(a,b){this.integrate(a,b);Math.abs(this.state.u)>=Math.PI/2&&(this.state.u=(Math.PI/2-Math.abs(Math.PI/2-Math.abs(this.state.u)))*Math.sign(this.state.u),this.state.s*=-1)};
function Ball(a,b,c,g){RK41DObject.call(this);this.nr=a;this.nx=b;this.ny=c;this.direction=g;this.state.u=0;this.state.s=1;this.counter=3}Ball.prototype=new RK41DObject;Ball.prototype.constructor=RK41DObject;Ball.prototype.acceleration=function(a,b){return-0.4};Ball.prototype.update=function(a,b,c){var g=this.state.u;this.integrate(a,b);a=this.state.u-g;this.nx+=a*Math.cos(this.direction);this.ny+=a*Math.sin(this.direction);this.bounce(c)};
Ball.prototype.bounce=function(a){this.nx>1-this.nr?(this.nx=1-this.nr,this.direction=normalizeRadian(Math.PI-this.direction)):this.nx<this.nr&&(this.nx=this.nr,this.direction=normalizeRadian(Math.PI-this.direction));this.ny>1-this.nr&&(this.ny=1-this.nr,this.direction=normalizeRadian(-this.direction));for(var b=0;b<a.length;++b){var c=a[b],g=this.nx-c.nx,h=this.ny-c.ny,k=vectorLength(g,h);k<=c.nr+this.nr&&(--c.counter,this.nx=c.nx+g*(this.nr+c.nr)/k,this.ny=c.ny+h*(this.nr+c.nr)/k,g=Math.atan2(h,
g),h=this.direction,k=this.state.s,c=-k*Math.cos(h-g)*Math.cos(g)+k*Math.sin(h-g)*Math.cos(g+Math.PI/2),g=-k*Math.cos(h-g)*Math.sin(g)+k*Math.sin(h-g)*Math.sin(g+Math.PI/2),this.direction=Math.atan2(g,c))}};Ball.prototype.grow=function(a){for(var b=Number.MAX_VALUE,c,g=0;g<a.length;++g)c=a[g],c=vectorLength(this.nx-c.nx,this.ny-c.ny)-c.nr,b>c&&(b=c);c=this.nx;b>c&&(b=c);c=1-this.nx;b>c&&(b=c);c=Math.abs(this.ny);b>c&&(b=c);c=Math.abs(1-this.ny);b>c&&(b=c);this.nr=Math.abs(b)};
function DontYouFillItGame(){this.state=this.PAUSED();this.cannon=new Cannon;this.staticBalls=[];this.currentBall=null;this.lastUpdateTime=performance.now?performance.now():Date.now();this.highscore=localStorage.getItem("highscore");this.highscore=null==this.highscore?0:parseInt(this.highscore,10);this.score=0;this.newHighscore=!1}DontYouFillItGame.prototype.PAUSED=function(){return 1};DontYouFillItGame.prototype.RUNNING=function(){return 2};DontYouFillItGame.prototype.GAMEOVER=function(){return 3};
DontYouFillItGame.prototype.update=function(a){if(this.currentBall)for(var b=this.lastUpdateTime,c=Math.floor(a-this.lastUpdateTime),g,h=1;h<=c;++h){g=(this.lastUpdateTime*(c-h)+a*h)/c;this.currentBall.update(b/1E3,(g-b)/1E3,this.staticBalls);for(b=this.staticBalls.length-1;0<=b;--b)0==this.staticBalls[b].counter&&(++this.score,this.staticBalls.splice(b,1));if(this.currentBall.ny<this.currentBall.nr&&normalizeRadian(this.currentBall.direction)>Math.PI){this.currentBall.state.s=0;if(this.newHighscore=
this.score>this.highscore)this.highscore=this.score,localStorage.setItem("highscore",this.score.toString(10));this.state=this.GAMEOVER()}if(0.001>this.currentBall.state.s){0<=this.currentBall.ny&&(this.currentBall.grow(this.staticBalls),this.staticBalls.push(this.currentBall));this.currentBall=null;break}b=g}this.cannon.update(this.lastUpdateTime/1E3,(a-this.lastUpdateTime)/1E3);this.lastUpdateTime=a};DontYouFillItGame.prototype.pause=function(){this.state=this.PAUSED()};
DontYouFillItGame.prototype.resume=function(){this.lastUpdateTime=performance.now?performance.now():Date.now();this.state=this.RUNNING()};DontYouFillItGame.prototype.reset=function(){this.currentBall=null;this.staticBalls=[];this.score=this.cannon.state.u=0;this.resume()};DontYouFillItGame.prototype.fire=function(){this.currentBall=new Ball(0.025,0.5+Math.cos(this.cannon.getAngle())/15,-1/6+1/15+Math.sin(this.cannon.getAngle())/15,this.cannon.getAngle())};function DontYouFillItCanvasGui(a,b){function c(a){var b=t+a.nx*f,c=p-a.ny*f,e=a.nr*f;d.fillStyle="white";d.lineWidth=1;d.beginPath();d.arc(b,c,e,0,2*Math.PI,!1);1==a.counter?(d.moveTo(b-0.2*e,c-0.7*e),d.lineTo(b-0.2*e,c+0.7*e),d.lineTo(b+0.2*e,c+0.7*e),d.lineTo(b+0.2*e,c-0.7*e)):2==a.counter?(d.moveTo(b-0.5*e,c-0.7*e),d.lineTo(b-0.5*e,c-0.3*e),d.lineTo(b+0.1*e,c-0.3*e),d.lineTo(b+0.1*e,c-0.15*e),d.lineTo(b-0.5*e,c-0.15*e),d.lineTo(b-0.5*e,c+0.7*e),d.lineTo(b+0.5*e,c+0.7*e),d.lineTo(b+0.5*e,c+0.3*
e),d.lineTo(b-0.1*e,c+0.3*e),d.lineTo(b-0.1*e,c+0.15*e),d.lineTo(b+0.5*e,c+0.15*e),d.lineTo(b+0.5*e,c-0.7*e)):3==a.counter&&(d.moveTo(b-0.5*e,c-0.7*e),d.lineTo(b-0.5*e,c-0.3*e),d.lineTo(b+0.1*e,c-0.3*e),d.lineTo(b+0.1*e,c-0.15*e),d.lineTo(b-0.5*e,c-0.15*e),d.lineTo(b-0.5*e,c+0.15*e),d.lineTo(b+0.1*e,c+0.15*e),d.lineTo(b+0.1*e,c+0.3*e),d.lineTo(b-0.5*e,c+0.3*e),d.lineTo(b-0.5*e,c+0.7*e),d.lineTo(b+0.5*e,c+0.7*e),d.lineTo(b+0.5*e,c-0.7*e));d.closePath();d.fill()}function g(b){A.observable.notifyObservers("beginStep");
a.state==a.RUNNING()&&a.update(b);d.fillStyle="black";d.fillRect(0,0,l.width,l.height);if(A.state==A.GAME){d.strokeStyle="white";d.lineWidth="1";d.beginPath();d.moveTo(Math.floor(t)+0.5,Math.floor(p)+0.5);d.lineTo(Math.floor(t)+0.5,Math.floor(x)+0.5);d.lineTo(Math.floor(D)-0.5,Math.floor(x)+0.5);d.lineTo(Math.floor(D)-0.5,Math.floor(p)+0.5);d.setLineDash||d.closePath();d.stroke();d.setLineDash&&(d.beginPath(),d.setLineDash([5,5]),d.moveTo(Math.floor(D)-0.5,Math.floor(p)+0.5),d.lineTo(Math.floor(t)+
0.5,Math.floor(p)+0.5),d.stroke(),d.setLineDash([]));b=Math.round(F/2);d.fillStyle="white";d.beginPath();d.moveTo(Math.round(v+f/2)-b,Math.round(p+f/6));d.lineTo(Math.round(v+f/2)-b,Math.round(p+f/6-C));d.arc(Math.round(v+f/2),Math.round(p+f/6-C),b,Math.PI,0);d.lineTo(Math.round(v+f/2)+b,Math.round(p+f/6));d.closePath();d.fill();d.lineWidth=G;d.lineCap="butt";d.beginPath();d.moveTo(v+f/2,p+f/6-C);d.lineTo(v+f/2+Math.cos(a.cannon.getAngle())*E,p+f/6-C-Math.sin(a.cannon.getAngle())*E);d.stroke();d.closePath();
for(b=0;b<a.staticBalls.length;++b)c(a.staticBalls[b]);a.currentBall&&c(a.currentBall);y.draw();d.textAlign="left";d.textBaseline="bottom";d.font=Math.floor(f/12)+"px Arial";d.fillText("Highscore",t,x-Math.floor(f/12)+Math.floor(f/120));d.fillText("Score",t,x);b=d.measureText("Highscore ").width;d.fillText(a.highscore,t+b,x-Math.floor(f/12)+Math.floor(f/120));d.fillText(a.score,t+b,x)}A.observable.notifyObservers("endStep");a.state==a.RUNNING()?window.requestAnimationFrame(g):a.state==a.GAMEOVER()&&
(document.getElementById("gameoverScreenScoreMessage").style.display=a.newHighscore?"none":"inline",document.getElementById("gameoverScreenHighscoreMessage").style.display=a.newHighscore?"inline":"none",document.getElementById("gameoverScreenScore").innerHTML=a.score,m(w,1))}function h(b,c){if(!(500>Date.now()-H)){H=Date.now();var d=l.getBoundingClientRect();y.handleClick(b-d.left,c-d.top)||null==a.currentBall&&a.state==a.RUNNING()&&a.fire()}}function k(){l.width=z.clientWidth;l.height=z.clientHeight;
var b=l.width,c=l.height;0.75>b/c?(r=b,n=4/3*r):(n=c,r=0.75*n);f=r;B=(c-n)/2;v=(b-r)/2;x=B+f/6;p=x+f;t=v;D=t+f;F=f/10;C=f/15;E=f/15;G=f/18;a.state!=a.RUNNING()&&window.requestAnimationFrame(g)}function m(a,b){a.style.zIndex=0<=b?b:-1;a.scrollTop=0;a.style.display=0<=b?"block":"none"}var y={draw:function(){d.fillStyle="white";a.state==a.RUNNING()&&(d.fillRect(l.width-Math.floor(0.9*(f/6)),Math.floor(0.1*(f/6)),Math.floor(0.3*(f/6)),Math.floor(0.8*(f/6))),d.fillRect(l.width-Math.floor(0.4*(f/6)),Math.floor(0.1*
(f/6)),Math.floor(0.3*(f/6)),Math.floor(0.8*(f/6))))},handleClick:function(b,c){return b>l.width-Math.floor(f/6)&&c<Math.floor(f/6)?(a.state==a.RUNNING()&&(a.pause(),m(q,1)),!0):!1}};this.MENU=1;this.GAME=2;this.state=this.MENU;this.game=a;this.observable=new Observable;var l=document.getElementById(b),z=l.parentNode,u=document.getElementById("startScreen"),q=document.getElementById("pauseScreen"),w=document.getElementById("gameoverScreen"),s=document.getElementById("licenseScreen");document.getElementById("startScreenPlayButton").addEventListener("click",
function(b){b.preventDefault();a.resume();A.state=A.GAME;window.requestAnimationFrame(g);m(u,-1)});document.getElementById("pauseScreenContinueButton").addEventListener("click",function(b){b.preventDefault();a.resume();window.requestAnimationFrame(g);m(q,-1)});document.getElementById("gameoverScreenPlayAgainButton").addEventListener("click",function(b){b.preventDefault();a.reset();window.requestAnimationFrame(g);m(w,-1)});document.getElementById("startScreenLicenseButton").addEventListener("click",
function(a){a.preventDefault();m(s,2)});document.getElementById("licenseScreenBackButton").addEventListener("click",function(a){a.preventDefault();m(s,-1)});var d=l.getContext("2d"),f,r,n,B,v,p,x,t,D,F,C,E,G,H=0,A=this;window.addEventListener("resize",k,!1);l.addEventListener("mousedown",function(a){a.preventDefault();h(a.clientX,a.clientY)},!1);l.addEventListener("touchstart",function(a){a.preventDefault();h(a.touches[0].clientX,a.touches[0].clientY)},!1);document.addEventListener("visibilitychange",
function(){document.hidden&&(a.pause(),m(q,1))},!1);k();window.requestAnimationFrame(g)}DontYouFillItCanvasGui.prototype.addObserver=function(a){this.observable.addObserver(a)};DontYouFillItCanvasGui.prototype.removeObserver=function(a){this.observable.removeObserver(a)};DontYouFillItCanvasGui.prototype.notifyObservers=function(){this.observable.notifyObservers()};var game=new DontYouFillItGame,gui=new DontYouFillItCanvasGui(game,"c");function isDebug(){for(var a=window.location.search.substring(1).split("&"),b=0;b<a.length;b++)if("debug"==a[b].split("=")[0])return!0;return!1}if(isDebug()){var stats=new Stats;stats.setMode(0);stats.domElement.style.position="absolute";stats.domElement.style.left="0px";stats.domElement.style.bottom="0px";document.body.appendChild(stats.domElement);gui.addObserver(function(a){"beginStep"==a?stats.begin():"endStep"==a&&stats.end()})};
