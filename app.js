Date.now||(Date.now=function(){return(new Date).getTime()});
(function(){for(var a=["webkit","moz"],b=0;b<a.length&&!window.requestAnimationFrame;++b){var c=a[b];window.requestAnimationFrame=window[c+"RequestAnimationFrame"];window.cancelAnimationFrame=window[c+"CancelAnimationFrame"]||window[c+"CancelRequestAnimationFrame"]}if(/iP(ad|hone|od).*OS 6/.test(window.navigator.userAgent)||!window.requestAnimationFrame||!window.cancelAnimationFrame){var f=0;window.requestAnimationFrame=function(a){var b=Date.now(),c=Math.max(f+16,b);return setTimeout(function(){a(f=
c)},c-b)};window.cancelAnimationFrame=clearTimeout}})();var Stats=function(){var a=Date.now(),b=a,c=0,f=Infinity,k=0,l=0,u=Infinity,y=0,n=0,z=0,h=document.createElement("div");h.id="stats";h.addEventListener("mousedown",function(a){a.preventDefault();t(++z%2)},!1);h.style.cssText="width:80px;opacity:0.9;cursor:pointer";var m=document.createElement("div");m.id="fps";m.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#002";h.appendChild(m);var x=document.createElement("div");x.id="fpsText";x.style.cssText="color:#0ff;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px";
x.innerHTML="FPS";m.appendChild(x);var q=document.createElement("div");q.id="fpsGraph";q.style.cssText="position:relative;width:74px;height:30px;background-color:#0ff";for(m.appendChild(q);74>q.children.length;){var v=document.createElement("span");v.style.cssText="width:1px;height:30px;float:left;background-color:#113";q.appendChild(v)}var r=document.createElement("div");r.id="ms";r.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#020;display:none";h.appendChild(r);var d=document.createElement("div");
d.id="msText";d.style.cssText="color:#0f0;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px";d.innerHTML="MS";r.appendChild(d);var g=document.createElement("div");g.id="msGraph";g.style.cssText="position:relative;width:74px;height:30px;background-color:#0f0";for(r.appendChild(g);74>g.children.length;)v=document.createElement("span"),v.style.cssText="width:1px;height:30px;float:left;background-color:#131",g.appendChild(v);var t=function(a){z=a;switch(z){case 0:m.style.display=
"block";r.style.display="none";break;case 1:m.style.display="none",r.style.display="block"}};return{REVISION:12,domElement:h,setMode:t,begin:function(){a=Date.now()},end:function(){var h=Date.now();c=h-a;f=Math.min(f,c);k=Math.max(k,c);d.textContent=c+" MS ("+f+"-"+k+")";var m=Math.min(30,30-30*(c/200));g.appendChild(g.firstChild).style.height=m+"px";n++;h>b+1E3&&(l=Math.round(1E3*n/(h-b)),u=Math.min(u,l),y=Math.max(y,l),x.textContent=l+" FPS ("+u+"-"+y+")",m=Math.min(30,30-30*(l/100)),q.appendChild(q.firstChild).style.height=
m+"px",b=h,n=0);return h},update:function(){a=this.end()}}};"object"===typeof module&&(module.exports=Stats);function Observable(){this.observers=[]}Observable.prototype.addObserver=function(a){this.observers.push(a)};Observable.prototype.removeObserver=function(a){a=this.observers.indexOf(a);~a&&this.observers.splice(a,1)};Observable.prototype.notifyObservers=function(a){for(var b=this.observers.length-1;0<=b;b--)this.observers[b](a)};Math.sign||(Math.__proto__.sign=function(a){return isNaN(a)?NaN:0===a?a:0<a?1:-1});function vectorLength(a,b){return Math.sqrt(a*a+b*b)}function RK41DObject_State(a,b){this.u=a;this.s=b}function RK41DObject_Derivative(a,b){this.du=a;this.ds=b}function RK41DObject(){this.state=new RK41DObject_State(0,0)}
RK41DObject.prototype.evaluate=function(a,b,c,f){if("undefined"==typeof c)return new RK41DObject_Derivative(a.s,this.acceleration(a,b));a=new RK41DObject_State(a.u+f.du*c,a.s+f.ds*c);return new RK41DObject_Derivative(a.s,this.acceleration(a,b+c))};
RK41DObject.prototype.integrate=function(a,b){var c=this.evaluate(this.state,a),f=this.evaluate(this.state,a,0.5*b,c),k=this.evaluate(this.state,a,0.5*b,f),l=this.evaluate(this.state,a,b,k),u=1/6*(c.ds+2*(f.ds+k.ds)+l.ds);this.state.u+=1/6*(c.du+2*(f.du+k.du)+l.du)*b;this.state.s+=u*b};function normalizeRadian(a){for(;a>2*Math.PI;)a-=2*Math.PI;for(;0>a;)a+=2*Math.PI;return a}function Cannon(){RK41DObject.call(this);this.state.u=0;this.state.s=Math.PI/3}Cannon.prototype=new RK41DObject;
Cannon.prototype.constructor=RK41DObject;Cannon.prototype.acceleration=function(a,b){return 0};Cannon.prototype.getAngle=function(){return this.state.u+Math.PI/2};Cannon.prototype.update=function(a,b){this.integrate(a,b);Math.abs(this.state.u)>=Math.PI/2&&(this.state.u=(Math.PI/2-Math.abs(Math.PI/2-Math.abs(this.state.u)))*Math.sign(this.state.u),this.state.s*=-1)};
function Ball(a,b,c,f){RK41DObject.call(this);this.nr=a;this.nx=b;this.ny=c;this.direction=f;this.state.u=0;this.state.s=1;this.counter=3}Ball.prototype=new RK41DObject;Ball.prototype.constructor=RK41DObject;Ball.prototype.acceleration=function(a,b){return-0.4};Ball.prototype.update=function(a,b,c){var f=this.state.u;this.integrate(a,b);a=this.state.u-f;this.nx+=a*Math.cos(this.direction);this.ny+=a*Math.sin(this.direction);this.bounce(c)};
Ball.prototype.bounce=function(a){this.nx>1-this.nr?(this.nx=1-this.nr,this.direction=normalizeRadian(Math.PI-this.direction)):this.nx<this.nr&&(this.nx=this.nr,this.direction=normalizeRadian(Math.PI-this.direction));this.ny>1-this.nr&&(this.ny=1-this.nr,this.direction=normalizeRadian(-this.direction));for(var b=0;b<a.length;++b){var c=a[b],f=this.nx-c.nx,k=this.ny-c.ny,l=vectorLength(f,k);l<=c.nr+this.nr&&(--c.counter,this.nx=c.nx+f*(this.nr+c.nr)/l,this.ny=c.ny+k*(this.nr+c.nr)/l,f=Math.atan2(k,
f),k=this.direction,l=this.state.s,c=-l*Math.cos(k-f)*Math.cos(f)+l*Math.sin(k-f)*Math.cos(f+Math.PI/2),f=-l*Math.cos(k-f)*Math.sin(f)+l*Math.sin(k-f)*Math.sin(f+Math.PI/2),this.direction=Math.atan2(f,c))}};Ball.prototype.grow=function(a){for(var b=Number.MAX_VALUE,c,f=0;f<a.length;++f)c=a[f],c=vectorLength(this.nx-c.nx,this.ny-c.ny)-c.nr,b>c&&(b=c);c=this.nx;b>c&&(b=c);c=1-this.nx;b>c&&(b=c);c=Math.abs(this.ny);b>c&&(b=c);c=Math.abs(1-this.ny);b>c&&(b=c);this.nr=Math.abs(b)};
function DontYouFillItGame(){this.state=this.PAUSED();this.cannon=new Cannon;this.staticBalls=[];this.currentBall=null;this.lastUpdateTime=performance.now?performance.now():Date.now();this.highscore=localStorage.getItem("highscore");this.highscore=null==this.highscore?0:parseInt(this.highscore,10);this.score=0;this.newHighscore=!1}DontYouFillItGame.prototype.PAUSED=function(){return 1};DontYouFillItGame.prototype.RUNNING=function(){return 2};DontYouFillItGame.prototype.GAMEOVER=function(){return 3};
DontYouFillItGame.prototype.update=function(a){if(this.currentBall)for(var b=this.lastUpdateTime,c=Math.floor(a-this.lastUpdateTime),f,k=1;k<=c;++k){f=(this.lastUpdateTime*(c-k)+a*k)/c;this.currentBall.update(b/1E3,(f-b)/1E3,this.staticBalls);for(b=this.staticBalls.length-1;0<=b;--b)0==this.staticBalls[b].counter&&(++this.score,this.staticBalls.splice(b,1));if(this.currentBall.ny<this.currentBall.nr&&normalizeRadian(this.currentBall.direction)>Math.PI){this.currentBall.state.s=0;if(this.newHighscore=
this.score>this.highscore)this.highscore=this.score,localStorage.setItem("highscore",this.score.toString(10));this.state=this.GAMEOVER()}if(0.001>this.currentBall.state.s){0<=this.currentBall.ny&&(this.currentBall.grow(this.staticBalls),this.staticBalls.push(this.currentBall));this.currentBall=null;break}b=f}this.cannon.update(this.lastUpdateTime/1E3,(a-this.lastUpdateTime)/1E3);this.lastUpdateTime=a};DontYouFillItGame.prototype.pause=function(){this.state=this.PAUSED()};
DontYouFillItGame.prototype.resume=function(){this.lastUpdateTime=performance.now?performance.now():Date.now();this.state=this.RUNNING()};DontYouFillItGame.prototype.reset=function(){this.currentBall=null;this.staticBalls=[];this.score=this.cannon.state.u=0;this.resume()};DontYouFillItGame.prototype.fire=function(){this.currentBall=new Ball(0.025,0.5+Math.cos(this.cannon.getAngle())/15,-1/6+1/15+Math.sin(this.cannon.getAngle())/15,this.cannon.getAngle())};function DontYouFillItCanvasGui(a,b){function c(a){var b=s+a.nx*g,c=p-a.ny*g,e=a.nr*g;d.fillStyle="white";d.lineWidth=1;d.beginPath();d.arc(b,c,e,0,2*Math.PI,!1);1==a.counter?(d.moveTo(b-0.2*e,c-0.7*e),d.lineTo(b-0.2*e,c+0.7*e),d.lineTo(b+0.2*e,c+0.7*e),d.lineTo(b+0.2*e,c-0.7*e)):2==a.counter?(d.moveTo(b-0.5*e,c-0.7*e),d.lineTo(b-0.5*e,c-0.3*e),d.lineTo(b+0.1*e,c-0.3*e),d.lineTo(b+0.1*e,c-0.15*e),d.lineTo(b-0.5*e,c-0.15*e),d.lineTo(b-0.5*e,c+0.7*e),d.lineTo(b+0.5*e,c+0.7*e),d.lineTo(b+0.5*e,c+0.3*
e),d.lineTo(b-0.1*e,c+0.3*e),d.lineTo(b-0.1*e,c+0.15*e),d.lineTo(b+0.5*e,c+0.15*e),d.lineTo(b+0.5*e,c-0.7*e)):3==a.counter&&(d.moveTo(b-0.5*e,c-0.7*e),d.lineTo(b-0.5*e,c-0.3*e),d.lineTo(b+0.1*e,c-0.3*e),d.lineTo(b+0.1*e,c-0.15*e),d.lineTo(b-0.5*e,c-0.15*e),d.lineTo(b-0.5*e,c+0.15*e),d.lineTo(b+0.1*e,c+0.15*e),d.lineTo(b+0.1*e,c+0.3*e),d.lineTo(b-0.5*e,c+0.3*e),d.lineTo(b-0.5*e,c+0.7*e),d.lineTo(b+0.5*e,c+0.7*e),d.lineTo(b+0.5*e,c-0.7*e));d.closePath();d.fill()}function f(b){A.observable.notifyObservers("beginStep");
a.state==a.RUNNING()&&a.update(b);d.fillStyle="black";d.fillRect(0,0,h.width,h.height);if(A.state==A.GAME){d.strokeStyle="white";d.lineWidth="1";d.beginPath();d.moveTo(Math.floor(s)+0.5,Math.floor(p)+0.5);d.lineTo(Math.floor(s)+0.5,Math.floor(w)+0.5);d.lineTo(Math.floor(D)-0.5,Math.floor(w)+0.5);d.lineTo(Math.floor(D)-0.5,Math.floor(p)+0.5);d.setLineDash||d.closePath();d.stroke();d.setLineDash&&(d.beginPath(),d.setLineDash([5,5]),d.moveTo(Math.floor(D)-0.5,Math.floor(p)+0.5),d.lineTo(Math.floor(s)+
0.5,Math.floor(p)+0.5),d.stroke(),d.setLineDash([]));b=Math.round(G/2);d.fillStyle="white";d.beginPath();d.moveTo(Math.round(g/2)-b,Math.round(p+g/6));d.lineTo(Math.round(g/2)-b,Math.round(p+g/6-C));d.arc(Math.round(g/2),Math.round(p+g/6-C),b,Math.PI,0);d.lineTo(Math.round(g/2)+b,Math.round(p+g/6));d.closePath();d.fill();d.lineWidth=H;d.lineCap="butt";d.beginPath();d.moveTo(g/2,p+g/6-C);d.lineTo(g/2+Math.cos(a.cannon.getAngle())*E,p+g/6-C-Math.sin(a.cannon.getAngle())*E);d.closePath();d.stroke();
for(b=0;b<a.staticBalls.length;++b)c(a.staticBalls[b]);a.currentBall&&c(a.currentBall);z.draw();d.textAlign="left";d.textBaseline="bottom";d.font=Math.floor(g/12)+"px Arial";d.fillText("Highscore",s,w-Math.floor(g/12)+Math.floor(g/120));d.fillText("Score",s,w);b=d.measureText("Highscore ").width;d.fillText(a.highscore,s+b,w-Math.floor(g/12)+Math.floor(g/120));d.fillText(a.score,s+b,w)}A.observable.notifyObservers("endStep");a.state==a.RUNNING()?window.requestAnimationFrame(f):a.state==a.GAMEOVER()&&
(document.getElementById("gameoverScreenScoreMessage").style.display=a.newHighscore?"none":"inline",document.getElementById("gameoverScreenHighscoreMessage").style.display=a.newHighscore?"inline":"none",document.getElementById("gameoverScreenScore").innerHTML=a.score,n(v,1))}function k(a){a.preventDefault();u(a.touches[0].clientX,a.touches[0].clientY)}function l(a){a.preventDefault();u(a.clientX,a.clientY)}function u(b,c){if(!(500>Date.now()-I)){I=Date.now();var d=h.getBoundingClientRect();z.handleClick(b-
d.left,c-d.top)||null==a.currentBall&&a.state==a.RUNNING()&&a.fire()}}function y(){var b=m.clientWidth,c=m.clientHeight;0.75>b/c?(t=b,B=4/3*t):(B=c,t=0.75*B);g=t;F=(c-B)/2;J=(b-t)/2;w=g/6;p=w+g;s=0;D=s+g;G=g/10;C=g/15;E=g/15;H=g/18;h.width=Math.floor(t);h.height=Math.floor(B);h.style.left=Math.floor(J)+"px";h.style.top=Math.floor(F)+"px";a.state!=a.RUNNING()&&window.requestAnimationFrame(f)}function n(a,b){a.style.zIndex=0<=b?b:-1;a.scrollTop=0;a.style.display=0<=b?"block":"none"}var z={draw:function(){d.fillStyle=
"white";d.fillRect(h.width-Math.floor(0.9*(g/6)),Math.floor(0.1*(g/6)),Math.floor(0.3*(g/6)),Math.floor(0.8*(g/6)));d.fillRect(h.width-Math.floor(0.4*(g/6)),Math.floor(0.1*(g/6)),Math.floor(0.3*(g/6)),Math.floor(0.8*(g/6)))},handleClick:function(b,c){var d=h.width,e=g/6;return b>h.width-g/6&&b<=d&&0<c&&c<=e?(a.state==a.RUNNING()&&(a.pause(),n(q,1)),!0):!1}};this.MENU=1;this.GAME=2;this.state=this.MENU;this.game=a;this.observable=new Observable;var h=document.getElementById(b),m=h.parentNode,x=document.getElementById("startScreen"),
q=document.getElementById("pauseScreen"),v=document.getElementById("gameoverScreen"),r=document.getElementById("licenseScreen");document.getElementById("startScreenPlayButton").addEventListener("click",function(b){b.preventDefault();a.resume();A.state=A.GAME;window.requestAnimationFrame(f);n(x,-1)});document.getElementById("pauseScreenContinueButton").addEventListener("click",function(b){b.preventDefault();a.resume();window.requestAnimationFrame(f);n(q,-1)});document.getElementById("gameoverScreenPlayAgainButton").addEventListener("click",
function(b){b.preventDefault();a.reset();window.requestAnimationFrame(f);n(v,-1)});document.getElementById("startScreenLicenseButton").addEventListener("click",function(a){a.preventDefault();n(r,2)});document.getElementById("licenseScreenBackButton").addEventListener("click",function(a){a.preventDefault();n(r,-1)});var d=h.getContext("2d"),g,t,B,F,J,p,w,s,D,G,C,E,H,I=0,A=this;window.addEventListener("resize",y,!1);[h,m].forEach(function(a){a.addEventListener("mousedown",l,!1);a.addEventListener("touchstart",
k,!1)});document.addEventListener("visibilitychange",function(){document.hidden&&(a.pause(),n(q,1))},!1);y();window.requestAnimationFrame(f)}DontYouFillItCanvasGui.prototype.addObserver=function(a){this.observable.addObserver(a)};DontYouFillItCanvasGui.prototype.removeObserver=function(a){this.observable.removeObserver(a)};DontYouFillItCanvasGui.prototype.notifyObservers=function(){this.observable.notifyObservers()};var game=new DontYouFillItGame,gui=new DontYouFillItCanvasGui(game,"c");function isDebug(){for(var a=window.location.search.substring(1).split("&"),b=0;b<a.length;b++)if("debug"==a[b].split("=")[0])return!0;return!1}if(isDebug()){var stats=new Stats;stats.setMode(0);stats.domElement.style.position="absolute";stats.domElement.style.left="0px";stats.domElement.style.bottom="0px";document.body.appendChild(stats.domElement);gui.addObserver(function(a){"beginStep"==a?stats.begin():"endStep"==a&&stats.end()})};
