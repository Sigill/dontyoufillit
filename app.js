Date.now||(Date.now=function(){return(new Date).getTime()});
(function(){for(var a=["webkit","moz"],c=0;c<a.length&&!window.requestAnimationFrame;++c){var b=a[c];window.requestAnimationFrame=window[b+"RequestAnimationFrame"];window.cancelAnimationFrame=window[b+"CancelAnimationFrame"]||window[b+"CancelRequestAnimationFrame"]}if(/iP(ad|hone|od).*OS 6/.test(window.navigator.userAgent)||!window.requestAnimationFrame||!window.cancelAnimationFrame){var d=0;window.requestAnimationFrame=function(a){var b=Date.now(),c=Math.max(d+16,b);return setTimeout(function(){a(d=
c)},c-b)};window.cancelAnimationFrame=clearTimeout}})();var supportsPassive=!1;try{var opts=Object.defineProperty({},"passive",{get:function(){supportsPassive=!0}});window.addEventListener("testPassive",null,opts);window.removeEventListener("testPassive",null,opts)}catch(e$$12){};(function(a,c){"object"===typeof exports&&"undefined"!==typeof module?module.exports=c():"function"===typeof define&&define.amd?define(c):a.Stats=c()})(this,function(){var a=function(){function c(a){g.appendChild(a.dom);return a}function b(a){for(var b=0;b<g.children.length;b++)g.children[b].style.display=b===a?"block":"none";e=a}function d(){return performance&&performance.now?performance.now():Date.now()}var e=0,g=document.createElement("div");g.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000";
g.addEventListener("click",function(a){a.preventDefault();b(++e%g.children.length)},!1);var m=d(),h=m,r=0,n=c(new a.Panel("FPS","#0ff","#002")),u=c(new a.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var s=c(new a.Panel("MB","#f08","#201"));b(0);return{REVISION:16,dom:g,addPanel:c,showPanel:b,begin:function(){m=d()},end:function(){r++;var a=d();u.update(a-m,200);if(a>=h+1E3&&(n.update(1E3*r/(a-h),100),h=a,r=0,s)){var b=performance.memory;s.update(b.usedJSHeapSize/1048576,
b.jsHeapSizeLimit/1048576)}return a},update:function(){m=this.end()},domElement:g,setMode:b}};a.Panel=function(a,b,d){var e=Infinity,g=0,m=Math.round,h=m(window.devicePixelRatio||1),r=80*h,n=48*h,u=3*h,s=2*h,p=3*h,q=15*h,l=74*h,v=30*h,x=document.createElement("canvas");x.width=r;x.height=n;x.style.cssText="width:80px;height:48px";var k=x.getContext("2d");k.font="bold "+9*h+"px Helvetica,Arial,sans-serif";k.textBaseline="top";k.fillStyle=d;k.fillRect(0,0,r,n);k.fillStyle=b;k.fillText(a,u,s);k.fillRect(p,
q,l,v);k.fillStyle=d;k.globalAlpha=0.9;k.fillRect(p,q,l,v);return{dom:x,update:function(n,w){e=Math.min(e,n);g=Math.max(g,n);k.fillStyle=d;k.globalAlpha=1;k.fillRect(0,0,r,q);k.fillStyle=b;k.fillText(m(n)+" "+a+" ("+m(e)+"-"+m(g)+")",u,s);k.drawImage(x,p+h,q,l-h,v,p,q,l-h,v);k.fillRect(p+l-h,q,h,v);k.fillStyle=d;k.globalAlpha=0.9;k.fillRect(p+l-h,q,h,m((1-n/w)*v))}}};return a});function Observable(){this.observers=[]}Observable.prototype.addObserver=function(a){this.observers.push(a)};Observable.prototype.removeObserver=function(a){a=this.observers.indexOf(a);~a&&this.observers.splice(a,1)};Observable.prototype.hasObserver=function(a){return~this.observers.indexOf(a)?!0:!1};Observable.prototype.notifyObservers=function(){for(var a=this.observers.length-1;0<=a;a--)this.observers[a].apply(null,arguments)};Math.sign||(Math.__proto__.sign=function(a){return isNaN(a)?NaN:0===a?a:0<a?1:-1});function vectorLength(a,c){return Math.sqrt(a*a+c*c)}function RK41DObject_State(a,c){this.u=a;this.s=c}function RK41DObject_Derivative(a,c){this.du=a;this.ds=c}function RK41DObject(){this.state=new RK41DObject_State(0,0)}
RK41DObject.prototype.evaluate=function(a,c,b,d){if("undefined"==typeof b)return new RK41DObject_Derivative(a.s,this.acceleration(a,c));a=new RK41DObject_State(a.u+d.du*b,a.s+d.ds*b);return new RK41DObject_Derivative(a.s,this.acceleration(a,c+b))};
RK41DObject.prototype.integrate=function(a,c){var b=this.evaluate(this.state,a),d=this.evaluate(this.state,a,0.5*c,b),e=this.evaluate(this.state,a,0.5*c,d),g=this.evaluate(this.state,a,c,e),m=1/6*(b.ds+2*(d.ds+e.ds)+g.ds);this.state.u+=1/6*(b.du+2*(d.du+e.du)+g.du)*c;this.state.s+=m*c};function normalizeRadian(a){for(;a>2*Math.PI;)a-=2*Math.PI;for(;0>a;)a+=2*Math.PI;return a}function Cannon(){RK41DObject.call(this);this.state.u=0;this.state.s=Math.PI/3}Cannon.prototype=new RK41DObject;
Cannon.prototype.constructor=RK41DObject;Cannon.prototype.acceleration=function(a,c){return 0};Cannon.prototype.getAngle=function(){return this.state.u+Math.PI/2};Cannon.prototype.update=function(a,c){this.integrate(a,c);Math.abs(this.state.u)>=Math.PI/2&&(this.state.u=(Math.PI/2-Math.abs(Math.PI/2-Math.abs(this.state.u)))*Math.sign(this.state.u),this.state.s*=-1)};
function Ball(a,c,b,d){RK41DObject.call(this);this.nr=a;this.nx=c;this.ny=b;this.direction=d;this.state.u=0;this.state.s=1;this.counter=3}Ball.prototype=new RK41DObject;Ball.prototype.constructor=RK41DObject;Ball.prototype.acceleration=function(a,c){return-0.4};Ball.prototype.update=function(a,c,b){var d=this.state.u;this.integrate(a,c);a=this.state.u-d;this.nx+=a*Math.cos(this.direction);this.ny+=a*Math.sin(this.direction);this.bounce(b)};
Ball.prototype.bounce=function(a){this.nx>1-this.nr?(this.nx=1-this.nr,this.direction=normalizeRadian(Math.PI-this.direction)):this.nx<this.nr&&(this.nx=this.nr,this.direction=normalizeRadian(Math.PI-this.direction));this.ny>1-this.nr&&(this.ny=1-this.nr,this.direction=normalizeRadian(-this.direction));for(var c=0;c<a.length;++c){var b=a[c],d=this.nx-b.nx,e=this.ny-b.ny,g=vectorLength(d,e);g<=b.nr+this.nr&&(--b.counter,this.nx=b.nx+d*(this.nr+b.nr)/g,this.ny=b.ny+e*(this.nr+b.nr)/g,d=Math.atan2(e,
d),e=this.direction,g=this.state.s,b=-g*Math.cos(e-d)*Math.cos(d)+g*Math.sin(e-d)*Math.cos(d+Math.PI/2),d=-g*Math.cos(e-d)*Math.sin(d)+g*Math.sin(e-d)*Math.sin(d+Math.PI/2),this.direction=Math.atan2(d,b))}};Ball.prototype.grow=function(a){for(var c=Number.MAX_VALUE,b,d=0;d<a.length;++d)b=a[d],b=vectorLength(this.nx-b.nx,this.ny-b.ny)-b.nr,c>b&&(c=b);b=this.nx;c>b&&(c=b);b=1-this.nx;c>b&&(c=b);b=Math.abs(this.ny);c>b&&(c=b);b=Math.abs(1-this.ny);c>b&&(c=b);this.nr=Math.abs(c)};
function DontYouFillItGame(){this.state=this.PAUSED();this.cannon=new Cannon;this.staticBalls=[];this.currentBall=null;this.lastUpdateTime=performance.now?performance.now():Date.now();this.score=0;this.DEFAULT_BALL_RADIUS=0.025;this.CANNON_Y_POSITION=-1/6;this.CANNON_BASE_HEIGHT=1/15;this.CANNON_LENGTH=1/15}DontYouFillItGame.prototype.PAUSED=function(){return 1};DontYouFillItGame.prototype.RUNNING=function(){return 2};DontYouFillItGame.prototype.GAMEOVER=function(){return 3};
DontYouFillItGame.prototype.update=function(a){if(this.currentBall)for(var c=this.lastUpdateTime,b=Math.floor(a-this.lastUpdateTime),d,e=1;e<=b;++e){d=(this.lastUpdateTime*(b-e)+a*e)/b;this.currentBall.update(c/1E3,(d-c)/1E3,this.staticBalls);for(c=this.staticBalls.length-1;0<=c;--c)0==this.staticBalls[c].counter&&(++this.score,this.staticBalls.splice(c,1));if(this.currentBall.ny<this.currentBall.nr&&normalizeRadian(this.currentBall.direction)>Math.PI)this.currentBall.state.s=0,this.state=this.GAMEOVER();
else if(0.001>this.currentBall.state.s){0<=this.currentBall.ny&&(this.currentBall.grow(this.staticBalls),this.staticBalls.push(this.currentBall));this.currentBall=null;break}c=d}this.cannon.update(this.lastUpdateTime/1E3,(a-this.lastUpdateTime)/1E3);this.lastUpdateTime=a};DontYouFillItGame.prototype.pause=function(){this.state=this.PAUSED()};DontYouFillItGame.prototype.resume=function(){this.lastUpdateTime=performance.now?performance.now():Date.now();this.state=this.RUNNING()};
DontYouFillItGame.prototype.reset=function(){this.currentBall=null;this.staticBalls=[];this.score=this.cannon.state.u=0;this.resume()};DontYouFillItGame.prototype.fire=function(){this.currentBall=new Ball(this.DEFAULT_BALL_RADIUS,0.5+Math.cos(this.cannon.getAngle())*this.CANNON_LENGTH,this.CANNON_Y_POSITION+this.CANNON_BASE_HEIGHT+Math.sin(this.cannon.getAngle())*this.CANNON_LENGTH,this.cannon.getAngle())};function DontYouFillItCanvasGui(a,c){function b(d){h.observable.notifyObservers("beginStep");a.state==a.RUNNING()&&a.update(d);if(h.state==h.GAME){if(void 0===w||w.score!=a.score)x.innerHTML=c,k.innerHTML=a.score;if(void 0!=w)for(d=0;d<w.previousBalls.length;++d){var f=w.previousBalls[d];0==f.counter&&void 0!==f.css&&(f.css.parentNode.removeChild(f.css),delete f.css)}for(d=0;d<a.staticBalls.length;++d){var f=a.staticBalls[d],e=void 0===f.css;e&&(f.css=q.cloneNode(!0),s.appendChild(f.css));if(void 0===
f.was||f.was!=f.counter){var g=f.css.classList;void 0!==f.was&&g.remove("B"+f.was);f.was=f.counter;g.add("B"+f.counter)}if(r||e)e=(1-f.ny-f.nr)*(t-2),f.css.style.left=(f.nx-f.nr)*(t-2)+"px",f.css.style.top=e+"px",f.css.style.width=f.css.style.height=200*f.nr+"%",f.css.style.display="block"}r=!1;v.style.transform=v.style.webkitTransform="rotate(-"+a.cannon.getAngle()+"rad)";a.currentBall?(l.style.transform=l.style.webkitTransform="translate("+(a.currentBall.nx-a.currentBall.nr)*(t-2)+"px, "+(1-a.currentBall.ny-
a.currentBall.nr)*(t-2)+"px)",l.style.display="block"):l.style.display="none";w={previousBalls:a.staticBalls.slice(),score:a.score}}h.observable.notifyObservers("endStep");if(a.state==a.RUNNING())window.requestAnimationFrame(b);else if(a.state==a.GAMEOVER()){c=Math.max(a.score,c);h.observable.notifyObservers("gameover",a.score);for(d=0;d<a.staticBalls.length;++d)f=a.staticBalls[d],f.css.parentNode.removeChild(f.css),delete f.css}}function d(){a.state==a.RUNNING()&&(a.pause(),h.observable.notifyObservers("pause"))}
function e(){var c=n.clientWidth,d=n.clientHeight;y=t=0.75>c/d?c:Math.floor(0.75*d);z=Math.floor(4/3*t);B=Math.floor((d-z)/2);C=Math.floor((c-y)/2);D=Math.floor(t/6);document.getElementById("Score").style.font=t/12+"px/1 Arial";u.style.width=y+"px";u.style.height=z+"px";u.style.left=C+"px";u.style.top=B+"px";s.style.width=s.style.height=t+"px";p.style.width=p.style.height=t+"px";s.style.top=p.style.top=D+"px";l.style.width=l.style.height=200*a.DEFAULT_BALL_RADIUS+"%";r=!0;a.state!=a.RUNNING()&&window.requestAnimationFrame(b)}
function g(a){if(500>a.timeStamp-A)return!0;A=a.timeStamp;return!1}function m(a,b){var c="string"===typeof a?document.getElementById(a):a;c.addEventListener("click",b);c.addEventListener("touchstart",b,supportsPassive?{passive:!1}:!1)}var h=this,r=!0;this.MENU=1;this.GAME=2;this.state=this.MENU;this.game=a;this.observable=new Observable;var n=document.getElementById("Game"),u=document.getElementById("Board"),s=document.getElementById("StaticBallLayer"),p=document.getElementById("LiveBallLayer"),q=
document.getElementById("DefaultBall");q.removeAttribute("id");var l=q.cloneNode(!0);l.setAttribute("id","LiveBall");l.classList.add("B3");l.style.display="none";p.appendChild(l);var v=document.getElementById("Turret"),x=document.getElementById("highscore"),k=document.getElementById("score"),A=0,w=void 0,t,y,z,B,C,D;window.addEventListener("resize",e,!1);m("PauseButton",function(a){a.preventDefault();a.stopPropagation();g(a)||d()});m(n,function(b){b.preventDefault();g(b)||null==a.currentBall&&a.state==
a.RUNNING()&&a.fire()});document.addEventListener("visibilitychange",function(){document.hidden&&d()},!1);this.resume=function(){a.resume();this.state=this.GAME;window.requestAnimationFrame(b)};this.reset=function(){w=void 0;a.reset();window.requestAnimationFrame(b)};e();window.requestAnimationFrame(b)}DontYouFillItCanvasGui.prototype.addObserver=function(a){this.observable.addObserver(a)};DontYouFillItCanvasGui.prototype.removeObserver=function(a){this.observable.removeObserver(a)};
DontYouFillItCanvasGui.prototype.hasObserver=function(a){return this.observable.hasObserver(a)};DontYouFillItCanvasGui.prototype.notifyObservers=function(){this.observable.notifyObservers()};var game=new DontYouFillItGame,gui=new DontYouFillItCanvasGui(game,parseInt(localStorage.getItem("highscore"),10)||0),stats=new Stats;stats.showPanel(0);stats.dom.style.removeProperty("top");stats.dom.style.position="fixed";stats.dom.style.left="0px";stats.dom.style.bottom="0px";stats.dom.style.display="none";document.body.appendChild(stats.dom);function statsObserver(a){"beginStep"==a?stats.begin():"endStep"==a&&stats.end()}
function setDebugMode(a){localStorage.setItem("debug",a);a?(stats.dom.style.display="block",gui.addObserver(statsObserver)):(stats.dom.style.display="none",gui.removeObserver(statsObserver))}function asBool(a){return!0===a||"true"===a}var query_string={};window.location.search.substring(1).split("&").forEach(function(a){a=a.split("=",2);query_string[a[0]]=2==a.length?a[1]:!0});
void 0!==query_string.debug?setDebugMode(asBool(query_string.debug)):null!==localStorage.getItem("debug")?setDebugMode(asBool(localStorage.getItem("debug"))):setDebugMode(!1);
var screenContainer=document.getElementById("screenContainer"),startScreen=document.getElementById("startScreen"),optionsScreen=document.getElementById("optionsScreen"),pauseScreen=document.getElementById("pauseScreen"),gameoverScreen=document.getElementById("gameoverScreen"),licenseScreen=document.getElementById("licenseScreen"),screens=[];
function pushScreen(a){0!=screens.length&&(screens[screens.length-1].style.display="none");screens.push(a);a.style.zIndex=screens.length;a.style.visibility="hidden";a.style.display="block";a.scrollTop=0;a.style.visibility="visible";screenContainer.style.display="block";screenContainer.style.backgroundColor=a==pauseScreen?"rgba(0, 0, 0, 0.85)":"black"}
function popScreen(){0!=screens.length&&(screens.pop().style.display="none",0==screens.length?screenContainer.style.display="none":screens[screens.length-1].style.display="block")}function popAllScreens(){for(;0<screens.length;)screens.pop().style.display="none";screenContainer.style.display="none"}document.getElementById("startScreenPlayButton").addEventListener("click",function(a){a.preventDefault();gui.resume();popAllScreens()});
document.getElementById("startScreenOptionsButton").addEventListener("click",function(a){a.preventDefault();optionsScreen.init();pushScreen(optionsScreen)});document.getElementById("optionsScreenBackButton").addEventListener("click",function(a){a.preventDefault();popScreen()});document.getElementById("pauseScreenContinueButton").addEventListener("click",function(a){a.preventDefault();gui.resume();popScreen()});
document.getElementById("pauseScreenOptionsButton").addEventListener("click",function(a){a.preventDefault();pushScreen(optionsScreen)});document.getElementById("gameoverScreenPlayAgainButton").addEventListener("click",function(a){a.preventDefault();gui.reset();popAllScreens()});document.getElementById("startScreenLicenseButton").addEventListener("click",function(a){a.preventDefault();pushScreen(licenseScreen)});
document.getElementById("licenseScreenBackButton").addEventListener("click",function(a){a.preventDefault();popScreen();licenseScreen.reset()});document.getElementById("framerateCheckbox").addEventListener("change",function(a){setDebugMode(a.target.checked)});gui.addObserver(function(a){"pause"==a&&pushScreen(pauseScreen)});
gui.addObserver(function(a,c){if("gameover"==a){var b=parseInt(localStorage.getItem("highscore"),10)||0;(b=c>b)&&localStorage.setItem("highscore",c.toString(10));document.getElementById("gameoverScreenScoreMessage").style.display=b?"none":"inline";document.getElementById("gameoverScreenHighscoreMessage").style.display=b?"inline":"none";document.getElementById("gameoverScreenScore").innerHTML=c;pushScreen(gameoverScreen)}});pushScreen(startScreen);
function setNodeText(a,c){var b=a.firstChild;do if(3==b.nodeType){b.nodeValue=c;break}while(b=b.nextSibling)}
Array.prototype.forEach.call(document.getElementsByClassName("hideable"),function(a){var c=function(b){Array.prototype.forEach.call(document.getElementsByClassName(a.getAttribute("data-toggle")),b)};a.reset=function(){this.style.display="none";c(function(a){setNodeText(a,"[-]")})};c(function(b){b.addEventListener("click",function(b){var e="none"!=a.style.display;c(function(a){setNodeText(a,e?"[+]":"[-]")});a.style.display=e?"none":"block";b.preventDefault()})});a.style.display="none"});
optionsScreen.init=function(){document.getElementById("framerateCheckbox").checked=gui.hasObserver(statsObserver)};licenseScreen.reset=function(){Array.prototype.forEach.call(this.getElementsByClassName("hideable"),function(a){a.reset()})};
