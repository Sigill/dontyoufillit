Date.now||(Date.now=function(){return(new Date).getTime()});
(function(){for(var a=["webkit","moz"],b=0;b<a.length&&!window.requestAnimationFrame;++b){var c=a[b];window.requestAnimationFrame=window[c+"RequestAnimationFrame"];window.cancelAnimationFrame=window[c+"CancelAnimationFrame"]||window[c+"CancelRequestAnimationFrame"]}if(/iP(ad|hone|od).*OS 6/.test(window.navigator.userAgent)||!window.requestAnimationFrame||!window.cancelAnimationFrame){var d=0;window.requestAnimationFrame=function(a){var b=Date.now(),c=Math.max(d+16,b);return setTimeout(function(){a(d=
c)},c-b)};window.cancelAnimationFrame=clearTimeout}})();var supportsPassive=!1;try{var opts=Object.defineProperty({},"passive",{get:function(){supportsPassive=!0}});window.addEventListener("testPassive",null,opts);window.removeEventListener("testPassive",null,opts)}catch(e$$12){};(function(a,b){"object"===typeof exports&&"undefined"!==typeof module?module.exports=b():"function"===typeof define&&define.amd?define(b):a.Stats=b()})(this,function(){var a=function(){function b(a){e.appendChild(a.dom);return a}function c(a){for(var b=0;b<e.children.length;b++)e.children[b].style.display=b===a?"block":"none";f=a}function d(){return performance&&performance.now?performance.now():Date.now()}var f=0,e=document.createElement("div");e.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000";
e.addEventListener("click",function(a){a.preventDefault();c(++f%e.children.length)},!1);var l=d(),g=l,w=0,n=b(new a.Panel("FPS","#0ff","#002")),y=b(new a.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var x=b(new a.Panel("MB","#f08","#201"));c(0);return{REVISION:16,dom:e,addPanel:b,showPanel:c,begin:function(){l=d()},end:function(){w++;var a=d();y.update(a-l,200);if(a>=g+1E3&&(n.update(1E3*w/(a-g),100),g=a,w=0,x)){var b=performance.memory;x.update(b.usedJSHeapSize/1048576,
b.jsHeapSizeLimit/1048576)}return a},update:function(){l=this.end()},domElement:e,setMode:c}};a.Panel=function(a,c,d){var f=Infinity,e=0,l=Math.round,g=l(window.devicePixelRatio||1),w=80*g,n=48*g,y=3*g,x=2*g,q=3*g,r=15*g,s=74*g,t=30*g,u=document.createElement("canvas");u.width=w;u.height=n;u.style.cssText="width:80px;height:48px";var k=u.getContext("2d");k.font="bold "+9*g+"px Helvetica,Arial,sans-serif";k.textBaseline="top";k.fillStyle=d;k.fillRect(0,0,w,n);k.fillStyle=c;k.fillText(a,y,x);k.fillRect(q,
r,s,t);k.fillStyle=d;k.globalAlpha=0.9;k.fillRect(q,r,s,t);return{dom:u,update:function(m,n){f=Math.min(f,m);e=Math.max(e,m);k.fillStyle=d;k.globalAlpha=1;k.fillRect(0,0,w,r);k.fillStyle=c;k.fillText(l(m)+" "+a+" ("+l(f)+"-"+l(e)+")",y,x);k.drawImage(u,q+g,r,s-g,t,q,r,s-g,t);k.fillRect(q+s-g,r,g,t);k.fillStyle=d;k.globalAlpha=0.9;k.fillRect(q+s-g,r,g,l((1-m/n)*t))}}};return a});function Observable(){this.observers=[]}Observable.prototype.addObserver=function(a){this.observers.push(a)};Observable.prototype.removeObserver=function(a){a=this.observers.indexOf(a);~a&&this.observers.splice(a,1)};Observable.prototype.hasObserver=function(a){return~this.observers.indexOf(a)?!0:!1};Observable.prototype.notifyObservers=function(){for(var a=this.observers.length-1;0<=a;a--)this.observers[a].apply(null,arguments)};Math.sign||(Math.__proto__.sign=function(a){return isNaN(a)?NaN:0===a?a:0<a?1:-1});function vectorLength(a,b){return Math.sqrt(a*a+b*b)}function RK41DObject_State(a,b){this.u=a;this.s=b}function RK41DObject_Derivative(a,b){this.du=a;this.ds=b}function RK41DObject(){this.state=new RK41DObject_State(0,0)}
RK41DObject.prototype.evaluate=function(a,b,c,d){if("undefined"==typeof c)return new RK41DObject_Derivative(a.s,this.acceleration(a,b));a=new RK41DObject_State(a.u+d.du*c,a.s+d.ds*c);return new RK41DObject_Derivative(a.s,this.acceleration(a,b+c))};
RK41DObject.prototype.integrate=function(a,b){var c=this.evaluate(this.state,a),d=this.evaluate(this.state,a,0.5*b,c),f=this.evaluate(this.state,a,0.5*b,d),e=this.evaluate(this.state,a,b,f),l=1/6*(c.ds+2*(d.ds+f.ds)+e.ds);this.state.u+=1/6*(c.du+2*(d.du+f.du)+e.du)*b;this.state.s+=l*b};function normalizeRadian(a){for(;a>2*Math.PI;)a-=2*Math.PI;for(;0>a;)a+=2*Math.PI;return a}function Cannon(){RK41DObject.call(this);this.state.u=0;this.state.s=Math.PI/3}Cannon.prototype=new RK41DObject;
Cannon.prototype.constructor=RK41DObject;Cannon.prototype.acceleration=function(a,b){return 0};Cannon.prototype.getAngle=function(){return this.state.u+Math.PI/2};Cannon.prototype.update=function(a,b){this.integrate(a,b);Math.abs(this.state.u)>=Math.PI/2&&(this.state.u=(Math.PI/2-Math.abs(Math.PI/2-Math.abs(this.state.u)))*Math.sign(this.state.u),this.state.s*=-1)};
function Ball(a,b,c,d){RK41DObject.call(this);this.nr=a;this.nx=b;this.ny=c;this.direction=d;this.state.u=0;this.state.s=1;this.counter=3}Ball.prototype=new RK41DObject;Ball.prototype.constructor=RK41DObject;Ball.prototype.acceleration=function(a,b){return-0.4};Ball.prototype.update=function(a,b,c){var d=this.state.u;this.integrate(a,b);a=this.state.u-d;this.nx+=a*Math.cos(this.direction);this.ny+=a*Math.sin(this.direction);this.bounce(c)};
Ball.prototype.bounce=function(a){this.nx>1-this.nr?(this.nx=1-this.nr,this.direction=normalizeRadian(Math.PI-this.direction)):this.nx<this.nr&&(this.nx=this.nr,this.direction=normalizeRadian(Math.PI-this.direction));this.ny>1-this.nr&&(this.ny=1-this.nr,this.direction=normalizeRadian(-this.direction));for(var b=0;b<a.length;++b){var c=a[b],d=this.nx-c.nx,f=this.ny-c.ny,e=vectorLength(d,f);e<=c.nr+this.nr&&(--c.counter,this.nx=c.nx+d*(this.nr+c.nr)/e,this.ny=c.ny+f*(this.nr+c.nr)/e,d=Math.atan2(f,
d),f=this.direction,e=this.state.s,c=-e*Math.cos(f-d)*Math.cos(d)+e*Math.sin(f-d)*Math.cos(d+Math.PI/2),d=-e*Math.cos(f-d)*Math.sin(d)+e*Math.sin(f-d)*Math.sin(d+Math.PI/2),this.direction=Math.atan2(d,c))}};Ball.prototype.grow=function(a){for(var b=Number.MAX_VALUE,c,d=0;d<a.length;++d)c=a[d],c=vectorLength(this.nx-c.nx,this.ny-c.ny)-c.nr,b>c&&(b=c);c=this.nx;b>c&&(b=c);c=1-this.nx;b>c&&(b=c);c=Math.abs(this.ny);b>c&&(b=c);c=Math.abs(1-this.ny);b>c&&(b=c);this.nr=Math.abs(b)};
function DontYouFillItGame(){this.state=this.PAUSED();this.cannon=new Cannon;this.staticBalls=[];this.currentBall=null;this.lastUpdateTime=performance.now?performance.now():Date.now();this.score=0;this.DEFAULT_BALL_RADIUS=0.025;this.CANNON_Y_POSITION=-1/6;this.CANNON_BASE_HEIGHT=1/15;this.CANNON_LENGTH=1/15}DontYouFillItGame.prototype.PAUSED=function(){return 1};DontYouFillItGame.prototype.RUNNING=function(){return 2};DontYouFillItGame.prototype.GAMEOVER=function(){return 3};
DontYouFillItGame.prototype.update=function(a){if(this.currentBall)for(var b=this.lastUpdateTime,c=Math.floor(a-this.lastUpdateTime),d,f=1;f<=c;++f){d=(this.lastUpdateTime*(c-f)+a*f)/c;this.currentBall.update(b/1E3,(d-b)/1E3,this.staticBalls);for(b=this.staticBalls.length-1;0<=b;--b)0==this.staticBalls[b].counter&&(++this.score,this.staticBalls.splice(b,1));if(this.currentBall.ny<this.currentBall.nr&&normalizeRadian(this.currentBall.direction)>Math.PI)this.currentBall.state.s=0,this.state=this.GAMEOVER();
else if(0.001>this.currentBall.state.s){0<=this.currentBall.ny&&(this.currentBall.grow(this.staticBalls),this.staticBalls.push(this.currentBall));this.currentBall=null;break}b=d}this.cannon.update(this.lastUpdateTime/1E3,(a-this.lastUpdateTime)/1E3);this.lastUpdateTime=a};DontYouFillItGame.prototype.pause=function(){this.state=this.PAUSED()};DontYouFillItGame.prototype.resume=function(){this.lastUpdateTime=performance.now?performance.now():Date.now();this.state=this.RUNNING()};
DontYouFillItGame.prototype.reset=function(){this.currentBall=null;this.staticBalls=[];this.score=this.cannon.state.u=0;this.resume()};DontYouFillItGame.prototype.fire=function(){this.currentBall=new Ball(this.DEFAULT_BALL_RADIUS,0.5+Math.cos(this.cannon.getAngle())*this.CANNON_LENGTH,this.CANNON_Y_POSITION+this.CANNON_BASE_HEIGHT+Math.sin(this.cannon.getAngle())*this.CANNON_LENGTH,this.cannon.getAngle())};function DontYouFillItCanvasGui(a,b){function c(a){if(a<y)return y/a}function d(a,b,c){var d=a.nr*(v-2);void 0!==c&&(d=y);a="translate("+(a.nx*(v-2)-d)+"px, "+((1-a.ny)*(v-2)-d)+"px)";void 0!==c&&(a=a+" scale("+1/c+")");b.transform=b.webkitTransform=a}function f(p){n.observable.notifyObservers("beginStep");a.state==a.RUNNING()&&a.update(p);if(n.state==n.GAME){if(void 0===z||z.score!=a.score)H.innerHTML=b,I.innerHTML=a.score;if(void 0!=z)for(p=0;p<z.previousBalls.length;++p){var h=z.previousBalls[p];
0==h.counter&&void 0!==h.css&&(h.css.parentNode.removeChild(h.css),delete h.css)}for(p=0;p<a.staticBalls.length;++p){var h=a.staticBalls[p],e=void 0===h.css;e&&(h.css=k.cloneNode(!0),t.appendChild(h.css));if(void 0===h.was||h.was!=h.counter){var g=h.css.classList;void 0!==h.was&&g.remove("B"+h.was);h.was=h.counter;g.add("B"+h.counter)}if(x||e)e=c(h.nr*(v-2)),d(h,h.css.style,e),g=200*h.nr,void 0!==e&&(g*=e),h.css.style.width=h.css.style.height=g+"%",h.css.style.display="block"}x=!1;C.style.transform=
C.style.webkitTransform="rotate(-"+a.cannon.getAngle()+"rad)";a.currentBall?(d(a.currentBall,m.style,q),m.style.display="block"):m.style.display="none";z={previousBalls:a.staticBalls.slice(),score:a.score}}n.observable.notifyObservers("endStep");if(a.state==a.RUNNING())window.requestAnimationFrame(f);else if(a.state==a.GAMEOVER()){b=Math.max(a.score,b);n.observable.notifyObservers("gameover",a.score);for(p=0;p<a.staticBalls.length;++p)h=a.staticBalls[p],h.css.parentNode.removeChild(h.css),delete h.css}}
function e(){a.state==a.RUNNING()&&(a.pause(),n.observable.notifyObservers("pause"))}function l(){var b=r.clientWidth,d=r.clientHeight;A=v=0.75>b/d?b:Math.floor(0.75*d);B=Math.floor(4/3*v);D=Math.floor((d-B)/2);E=Math.floor((b-A)/2);F=Math.floor(v/6);q=c(a.DEFAULT_BALL_RADIUS*(v-2));document.getElementById("Score").style.font=v/12+"px/1 Arial";s.style.width=A+"px";s.style.height=B+"px";s.style.left=E+"px";s.style.top=D+"px";t.style.width=t.style.height=v+"px";u.style.width=u.style.height=v+"px";t.style.top=
u.style.top=F+"px";b=200*a.DEFAULT_BALL_RADIUS;void 0!==q&&(b*=q);m.style.width=m.style.height=b+"%";x=!0;a.state!=a.RUNNING()&&window.requestAnimationFrame(f)}function g(a){if(500>a.timeStamp-G)return!0;G=a.timeStamp;return!1}function w(a,b){var c="string"===typeof a?document.getElementById(a):a;c.addEventListener("click",b);c.addEventListener("touchstart",b,supportsPassive?{passive:!1}:!1)}var n=this,y=16,x=!0,q=void 0;this.MENU=1;this.GAME=2;this.state=this.MENU;this.game=a;this.observable=new Observable;
var r=document.getElementById("Game"),s=document.getElementById("Board"),t=document.getElementById("StaticBallLayer"),u=document.getElementById("LiveBallLayer"),k=document.getElementById("DefaultBall");k.removeAttribute("id");var m=k.cloneNode(!0);m.setAttribute("id","LiveBall");m.classList.add("B3");m.style.display="none";u.appendChild(m);var C=document.getElementById("Turret"),H=document.getElementById("highscore"),I=document.getElementById("score"),G=0,z=void 0,v,A,B,D,E,F;window.addEventListener("resize",
l,!1);w("PauseButton",function(a){a.preventDefault();a.stopPropagation();g(a)||e()});w(r,function(b){b.preventDefault();g(b)||null==a.currentBall&&a.state==a.RUNNING()&&a.fire()});document.addEventListener("visibilitychange",function(){document.hidden&&e()},!1);this.resume=function(){a.resume();this.state=this.GAME;window.requestAnimationFrame(f)};this.reset=function(){z=void 0;a.reset();window.requestAnimationFrame(f)};l();window.requestAnimationFrame(f)}
DontYouFillItCanvasGui.prototype.addObserver=function(a){this.observable.addObserver(a)};DontYouFillItCanvasGui.prototype.removeObserver=function(a){this.observable.removeObserver(a)};DontYouFillItCanvasGui.prototype.hasObserver=function(a){return this.observable.hasObserver(a)};DontYouFillItCanvasGui.prototype.notifyObservers=function(){this.observable.notifyObservers()};var game=new DontYouFillItGame,gui=new DontYouFillItCanvasGui(game,parseInt(localStorage.getItem("highscore"),10)||0),stats=new Stats;stats.showPanel(0);stats.dom.style.removeProperty("top");stats.dom.style.position="fixed";stats.dom.style.left="0px";stats.dom.style.bottom="0px";stats.dom.style.display="none";document.body.appendChild(stats.dom);function statsObserver(a){"beginStep"==a?stats.begin():"endStep"==a&&stats.end()}
function setDebugMode(a){localStorage.setItem("debug",a);a?(stats.dom.style.display="block",gui.addObserver(statsObserver)):(stats.dom.style.display="none",gui.removeObserver(statsObserver))}function asBool(a){return!0===a||"true"===a}var query_string={};window.location.search.substring(1).split("&").forEach(function(a){a=a.split("=",2);query_string[a[0]]=2==a.length?a[1]:!0});
void 0!==query_string.debug?setDebugMode(asBool(query_string.debug)):null!==localStorage.getItem("debug")?setDebugMode(asBool(localStorage.getItem("debug"))):setDebugMode(!1);
var screenContainer=document.getElementById("screenContainer"),startScreen=document.getElementById("startScreen"),optionsScreen=document.getElementById("optionsScreen"),pauseScreen=document.getElementById("pauseScreen"),gameoverScreen=document.getElementById("gameoverScreen"),licenseScreen=document.getElementById("licenseScreen"),screens=[];
function pushScreen(a){0!=screens.length&&(screens[screens.length-1].style.display="none");screens.push(a);a.style.zIndex=screens.length;a.style.visibility="hidden";a.style.display="block";a.scrollTop=0;a.style.visibility="visible";screenContainer.style.display="block";screenContainer.style.backgroundColor=a==pauseScreen?"rgba(0, 0, 0, 0.85)":"black"}
function popScreen(){0!=screens.length&&(screens.pop().style.display="none",0==screens.length?screenContainer.style.display="none":screens[screens.length-1].style.display="block")}function popAllScreens(){for(;0<screens.length;)screens.pop().style.display="none";screenContainer.style.display="none"}document.getElementById("startScreenPlayButton").addEventListener("click",function(a){a.preventDefault();gui.resume();popAllScreens()});
document.getElementById("startScreenOptionsButton").addEventListener("click",function(a){a.preventDefault();optionsScreen.init();pushScreen(optionsScreen)});document.getElementById("optionsScreenBackButton").addEventListener("click",function(a){a.preventDefault();popScreen()});document.getElementById("pauseScreenContinueButton").addEventListener("click",function(a){a.preventDefault();gui.resume();popScreen()});
document.getElementById("pauseScreenOptionsButton").addEventListener("click",function(a){a.preventDefault();pushScreen(optionsScreen)});document.getElementById("gameoverScreenPlayAgainButton").addEventListener("click",function(a){a.preventDefault();gui.reset();popAllScreens()});document.getElementById("startScreenLicenseButton").addEventListener("click",function(a){a.preventDefault();pushScreen(licenseScreen)});
document.getElementById("licenseScreenBackButton").addEventListener("click",function(a){a.preventDefault();popScreen();licenseScreen.reset()});document.getElementById("framerateCheckbox").addEventListener("change",function(a){setDebugMode(a.target.checked)});gui.addObserver(function(a){"pause"==a&&pushScreen(pauseScreen)});
gui.addObserver(function(a,b){if("gameover"==a){var c=parseInt(localStorage.getItem("highscore"),10)||0;(c=b>c)&&localStorage.setItem("highscore",b.toString(10));document.getElementById("gameoverScreenScoreMessage").style.display=c?"none":"inline";document.getElementById("gameoverScreenHighscoreMessage").style.display=c?"inline":"none";document.getElementById("gameoverScreenScore").innerHTML=b;pushScreen(gameoverScreen)}});pushScreen(startScreen);
function setNodeText(a,b){var c=a.firstChild;do if(3==c.nodeType){c.nodeValue=b;break}while(c=c.nextSibling)}
Array.prototype.forEach.call(document.getElementsByClassName("hideable"),function(a){var b=function(b){Array.prototype.forEach.call(document.getElementsByClassName(a.getAttribute("data-toggle")),b)};a.reset=function(){this.style.display="none";b(function(a){setNodeText(a,"[-]")})};b(function(c){c.addEventListener("click",function(c){var f="none"!=a.style.display;b(function(a){setNodeText(a,f?"[+]":"[-]")});a.style.display=f?"none":"block";c.preventDefault()})});a.style.display="none"});
optionsScreen.init=function(){document.getElementById("framerateCheckbox").checked=gui.hasObserver(statsObserver)};licenseScreen.reset=function(){Array.prototype.forEach.call(this.getElementsByClassName("hideable"),function(a){a.reset()})};
